<link rel="stylesheet" href="../resources/styles/elf-template.css">

## Filter Dialog

The Filter Dialog is a user-friendly interface for filtering and sorting. The example below shows how Filter Dialog can be used in conjunction with [Row Filtering Extension](../extensions/tr-grid-row-filtering.md). Users can hover over column header to show filter icon. Clicking on the icon will open Filter Dialog.

```live
<style>
	efx-grid {
		height: 500px;
	}
</style>

<efx-grid id="grid"></efx-grid>

<script>
	var fields = ["companyName", "market", "CF_LAST", "CF_NETCHNG", "industry"];
	var records = DataGenerator.generateRecords(fields, { seed: 0, numRows: 20 });
	var configObj = {
		columns: [
			{ name: "Company", field: fields[0] },
			{ name: "Market", field: fields[1], width: 120 },
			{ name: "Last", field: fields[2], width: 100 },
			{ name: "Net. Chng", field: fields[3], width: 100 },
			{ name: "Industry", field: fields[4] }
		],
		staticDataRows: records,
		rowFiltering:{
			iconActivation: "onHover"
		},
		extensions: [
			new RowFiltering()
		]
	};

	var grid = document.getElementById("grid");
	grid.config = configObj;
</script>
```

### Setup guide

```js
 // efx-grid
import "@refinitiv-ui/efx-grid";
import "@refinitiv-ui/efx-grid/themes/halo/light";

// Extensions
import { RowFiltering } from "@refinitiv-ui/efx-grid/extensions";

// Filter Dialog module
import "@refinitiv-ui/efx-grid/filter-dialog";
import "@refinitiv-ui/efx-grid/filter-dialog/themes/halo/light";  // !Important. Theme must be imported.

```

The dialog cannot be used without Row Filtering Extension. So, initialize Row Filtering Extension instance and add it to `extensions` property on the grid configuration object. To open the dialog, you can either use `iconActivation` property or `openDialog` method from the extension.

```js
var rowFilteringExt = new RowFiltering();

var configObj = {
	extensions: [
		rowFilteringExt
	],
	rowFiltering:{
		iconActivation: "onHover"
	},
	columns: columns, // Columns config
	staticDataRows: records
};

var grid = document.getElementById("grid_id");
grid.config = configObj;

function onClickButton(e) {
  rowFilteringExt.openDialog(columnIndex);
}
```

### Advanced condition tab

Filter dialog has three types of condition tabs: generic value condition (default), numeric value condition, and date time value condition. Each type has a different list of available operators. For example, numeric value condition contains only nemeric operators, such as Less than or Greater than operators. To specify the type for the dialog, define `fieldDataType` property on the column configuration object to one of the following values: `number`, `datetime`, and `text` or nothing (default). 

```live
<style>
	efx-grid {
		height: 500px;
	}
</style>

<efx-grid id="grid"></efx-grid>

<script>
	var fields = ["companyName", "CF_NETCHNG", "ISODate"];
	var records = DataGenerator.generateRecords(fields, { seed: 0, numRows: 20 });
	var configObj = {
		columns: [
			{ name: "Company", field: "companyName" },
			{ name: "Company (text)", field: "companyName", fieldDataType: "text" },
			{ name: "Date (generic)", field: "ISODate", width: 180 },
			{ name: "Date (datetime)", field: "ISODate", width: 180, fieldDataType: "datetime" },
			{ name: "Change (generic)", field: "CF_NETCHNG", width: 130 },
			{ name: "Change (number)", field: "CF_NETCHNG", width: 130, fieldDataType: "number" }
		],
		staticDataRows: records,
		rowFiltering:{
			iconActivation: "onHover"
		},
		extensions: [
			new RowFiltering()
		]
	};

	var grid = document.getElementById("grid");
	grid.config = configObj;
</script>
```

### Dialog options

Filter Dialog can be customized by setting `dialogOptions` property on the Row Filtering Extension configuration object as shown in the following code snippet:

```js
var configObj = {
	rowFiltering: {
		dialogOptions: {
			sortUI: false
		}
	}
};
```

The options will be applied for every column in the grid. The options can be overriden on a column basis by using `beforeDialogOpened` event. You can specify `dialogOptions` property on the event argument and override the options set on the grid level as shown in the following code snippet:

```js
var configObj = {
	rowFiltering: {
		dialogOptions: {
			sortUI: false
		},
		beforeDialogOpened: function(e) {
			if(e.field === "field A") {
				e.dialogOptions = {
					sortUI: true
				};
			}
		}
	}
};
```

### Customizing filter item list

By default, the item list in Filter Dialog is generated from existing data on the column, where the dialog is openned. Any duplicate value is automatically removed from the list. If there is formatting applied by Text Formatting Extension on the column, the items will also be formatted. 

`itemList` property on the dialog options can be used to replace the autogenerated one. This is useful when you want to prevent some values from being available for  filtering. 

`additionalItems` property on the dialog options can be used to add more values to the existing list. The property can be used to include some nonexistent values (e.g., you have some server side filtering).

`formattedDataAccessor` property on the dialog options allows you to specify a method for transforming and displaying items on the list. The method will be called on each item and it should return the formatted text you want to display in the dialog. The method can also be used to retrieve data from an object (i.e., data with non-premitive data type).

`sortLogic` property on the dialog options allows you to specify a method for reordering items on the list. The method will be used by [Array.sort method](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort)

```live
<style>
	efx-grid {
		height: 300px;
	}
</style>

<efx-grid id="grid"></efx-grid>

<script>
	var sortIdInDescendingOrder = function(valA, valB) {
		if(valA < valB) {
			return 1;
		}
		if(valB < valA) {
			return -1;
		}
		return 0;
	};
	var booleanToYesNo = function(val) {
		if(val != null) {
			return val ? "Yes" : "No";
		}
		return "";
	};
	var onBeforeDialogOpened = function(e) {
		var colIndex = e.colIndex;
		if(colIndex === 0) { // id
			e.dialogOptions = {
				sortLogic: sortIdInDescendingOrder
			};
		} else if(colIndex === 2) { // replacement
			e.dialogOptions = {
				itemList: ["Left", "Center", "Right"]
			};
		} else if(colIndex === 3) { // addition
			e.dialogOptions = {
				additionalItems: [1, 0, "N/A"]
			};
		} else if(colIndex === 4) { // formatted
			e.dialogOptions = {
				formattedDataAccessor: booleanToYesNo
			};
		}
	};
	var fields = ["id", "boolean"];
	var records = DataGenerator.generateRecords(fields, { seed: 0, numRows: 10 });
	var configObj = {
		rowFiltering: {
			iconActivation: "onHover",
			beforeDialogOpened: onBeforeDialogOpened
		},
		columns: [
			{ name: "Id", field: "id", width: 80 },
			{ name: "Boolean (default)", field: "boolean"},
			{ name: "Boolean (replacement)", field: "boolean"},
			{ name: "Boolean (addition)", field: "boolean"},
			{ name: "Boolean (formatted)", field: "boolean"}
		],
		staticDataRows: records,
		extensions: [
			new RowFiltering()
		]
	};

	var grid = document.getElementById("grid");
	grid.config = configObj;
</script>
```

### Changing dialog language

For more information about internationalization and how is it applied in different contexts see [Language Support](language-support.md).

### Opening Filter Dialog using an API

The dialog can be openned from anywhere, not just from filter icon on the column header. Use `openDialog` method from Row Filtering extension instance, so that the dialog can be openned for specific column and linked up with grid instance. 

The following example illustrates how the dialog can be opened from context menu using [Context Menu Extension](../extensions/tr-grid-contextmenu.md). Right click on the column header to see the dialog.

```live
<style>
	html hr {
		margin: 5px;
	}
	efx-grid {
		height: 500px;
	}
</style>
Language:
<select id="lang_selector">
	<option value="en">English</option>
	<option value="ja">Japanese</option>
	<option value="de">German</option>
	<option value="zh">Simplified Chinese</option>
	<option value="zh-Hant">Traditional Chinese</option>
</select>
<hr>
<efx-grid id="grid"></efx-grid>
<script>
	var rowFilteringExt = new RowFiltering();
	var contextMenuExt = new ContextMenu();

	var fields = ["companyName", "market", "CF_LAST", "CF_NETCHNG", "ISODate"];
	var records = DataGenerator.generateRecords(fields, { numRows: 10 });
	var configObj = {
		columns: [
			{name: "Company", field: fields[0], sortable: true, fieldDataType: "text"},
			{name: "Market", field: fields[1], width: 100, sortable: true, fieldDataType: "text"},
			{name: "Last", field: fields[2], width: 100, sortable: true, fieldDataType: "number"},
			{name: "Net. Chng", field: fields[3], width: 100, sortable: true, fieldDataType: "number"},
			{name: "IPO Date", field: fields[4], sortable: true, fieldDataType: "datetime"}
		],
		dataModel: {
			data: records
		},
		contextMenu: {
			items: {
				MENU_1: {
					text: "Filter",
					callback: function (e) {
						var colIndex = e.colIndex;
						var lang = document.getElementById("lang_selector").value;
						var dialogOptions = {
							sortUI: true, // Show sorting section
							filterUI: true, // Show filtering section
							lang: lang,
							fieldDataType: grid.api.getColumnDataType(colIndex)
						};
						rowFilteringExt.openDialog(colIndex, dialogOptions);
					}
				},
			},
			onMenu: function (e) {
				e.menu.addItem("MENU_1");
			}
		},
		extensions: [
			rowFilteringExt,
			contextMenuExt
		]
	};

	var grid = document.getElementById("grid");
	grid.config = configObj;
</script>
```

### Listening an event

If you want to do a custom task after the dialog has been commited, you can listen for `dialogCommitted` event from Row Filtering Extension. The change from the dialog will be passed as `value` property in the event argument. 

```js
var onDialogCommitted = function (e) {
	if(e.value) { // When user confirm dialog
		console.log(e)
	} else { // When user sort data from dialog
		console.log(e);
	}
}

var gridConfig = {
	rowFiltering: {
		dialogCommitted: onDialogCommitted
	}
};

// Alternatively
rowFilteringExt.addEventListener("dialogCommitted", onDialogCommitted);
```


<div></div>

<h2 style="margin-bottom:5px" id="api-refs">API Reference</h2>
<div id="elf-api-container"><div id="main-template" class="elf-template">    <section><article>                                                <h3 class="subsection-title">Type Definitions</h3>                        <div class="item">            <div class="item-type">typedef</div>    <h4 class="name" id="~Config">Config</h4>    <h5>Type:</h5>    <span class="param-type">Object</span>    <h5>Properties:</h5>    <div class="props"><table>    <thead>    <tr>                <th>Name</th>                <th>Type</th>                <th>Attributes</th>                        <th class="last">Description</th>    </tr>    </thead>    <tbody>            <tr>                            <td class="name"><code>data</code></td>                        <td class="type">                            <span class="param-type">Object</span>                        </td>                            <td class="attributes">                                                </td>                                    <td class="description last">Column data</td>        </tr>            <tr>                            <td class="name"><code>sortState</code></td>                        <td class="type">                            <span class="param-type">string</span>                        </td>                            <td class="attributes">                                    &lt;optional&gt;<br>                                                </td>                                    <td class="description last">"a" for ascending or "d" for descending</td>        </tr>            <tr>                            <td class="name"><code>sortUI</code></td>                        <td class="type">                            <span class="param-type">boolean</span>                        </td>                            <td class="attributes">                                    &lt;optional&gt;<br>                                                </td>                                    <td class="description last">Show Sort area</td>        </tr>            <tr>                            <td class="name"><code>filterUI</code></td>                        <td class="type">                            <span class="param-type">boolean</span>                        </td>                            <td class="attributes">                                    &lt;optional&gt;<br>                                                </td>                                    <td class="description last">Show Filter area</td>        </tr>            <tr>                            <td class="name"><code>filterChanged</code></td>                        <td class="type">                            <span class="param-type">function</span>                        </td>                            <td class="attributes">                                    &lt;optional&gt;<br>                                                </td>                                    <td class="description last">Filter changed handler</td>        </tr>            <tr>                            <td class="name"><code>confirm</code></td>                        <td class="type">                            <span class="param-type">function</span>                        </td>                            <td class="attributes">                                    &lt;optional&gt;<br>                                                </td>                                    <td class="description last">Alias of filterChanged</td>        </tr>            <tr>                            <td class="name"><code>cancel</code></td>                        <td class="type">                            <span class="param-type">function</span>                        </td>                            <td class="attributes">                                    &lt;optional&gt;<br>                                                </td>                                    <td class="description last">Alias of dialog cancel</td>        </tr>            <tr>                            <td class="name"><code>sortChanged</code></td>                        <td class="type">                            <span class="param-type">function</span>                        </td>                            <td class="attributes">                                    &lt;optional&gt;<br>                                                </td>                                    <td class="description last">Sort changed handler</td>        </tr>        </tbody></table></div><div class="details">                                                            </div></div>                            <h3 class="subsection-title">Methods</h3>                    <div class="item">                                <div class="item-type">function</div>                        <h4 class="name" id="hide"><span class="type-signature"></span>hide<span class="signature">()</span><span class="type-signature"></span></h4>                            <div class="description">        Hide the dialog    </div>                        <div class="details">                                                            </div>                                    </div>                    <div class="item">                                <div class="item-type">function</div>                        <h4 class="name" id="hideSortUI"><span class="type-signature"></span>hideSortUI<span class="signature">(val)</span><span class="type-signature"></span></h4>                            <div class="description">        Hide Sort UI block    </div>                            <h5>Parameters:</h5>        <div class="params">        <div class="param">                            <div class="name">val</div>                        <div class="type">                            <span class="param-type">boolean</span>                        </div>                                                    <div class="description">                    value                </div>                    </div>            </div>        <div class="details">                                                            </div>                                    </div>                    <div class="item">                                <div class="item-type">function</div>                        <h4 class="name" id="init"><span class="type-signature"></span>init<span class="signature">(options)</span><span class="type-signature"></span></h4>                            <div class="description">        Initialize dialog    </div>                            <h5>Parameters:</h5>        <div class="params">        <div class="param">                            <div class="name">options</div>                        <div class="type">                            <span class="param-type"><a href="#~Config">FilterDialog~Config</a></span>                        </div>                                                    <div class="description">                    initial data                </div>                    </div>            </div>        <div class="details">                                                            </div>                                    </div>                    <div class="item">                                <div class="item-type">function</div>                        <h4 class="name" id="setSortState"><span class="type-signature"></span>setSortState<span class="signature">(val)</span><span class="type-signature"></span></h4>                                                <h5>Parameters:</h5>        <div class="params">        <div class="param">                            <div class="name">val</div>                        <div class="type">                            <span class="param-type">string</span>                        </div>                                                    <div class="description">                    Sorting state "d" or "a"                </div>                    </div>            </div>        <div class="details">                                                            </div>                                    </div>                    <div class="item">                                <div class="item-type">function</div>                        <h4 class="name" id="show"><span class="type-signature"></span>show<span class="signature">()</span><span class="type-signature"></span></h4>                            <div class="description">        Show the dialog as a popup    </div>                        <div class="details">                                                            </div>                                    </div>                </article></section></div></div>