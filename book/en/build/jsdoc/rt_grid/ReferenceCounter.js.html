<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: ReferenceCounter.js</title>

    <script src="scripts/prettify.js"> </script>
    <script src="scripts/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/default.css">
    <link type="text/css" rel="stylesheet" href="styles/elf-template.css">
</head>

<body>

<div id="main-template" class="elf-template">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @constructor
*/
var ReferenceCounter = function() {
	this._counter = {};
	this._session = {};
	this._referers = {};
};

/** @type {Object.&lt;string, number&gt;}
* @private
**/
ReferenceCounter.prototype._counter = null;
/** @type {Object.&lt;string, number&gt;}
* @private
**/
ReferenceCounter.prototype._session = null;
/** @type {Object.&lt;string, Object&gt;}
* @private
**/
ReferenceCounter.prototype._referers = null;


/** @public
*/
ReferenceCounter.prototype.reset = function() {
	this._counter = {};
	this._referers = {};
	this.newSession();
};
/** @public
*/
ReferenceCounter.prototype.newSession = function() {
	this._session = {};
};

/** @public
* @return {!Array.&lt;string&gt;}
*/
ReferenceCounter.prototype.getAllReferences = function() {
	return Object.keys(this._counter);
};

/** @public
* @return {!Array.&lt;string&gt;}
*/
ReferenceCounter.prototype.getAllReferers = function() {
	return Object.keys(this._referers);
};
/** Alias to ReferenceCounter.getAllReferers
* @public
* @function
* @return {!Array.&lt;string&gt;}
*/
ReferenceCounter.prototype.getAllReferrers = ReferenceCounter.prototype.getAllReferers;

/** @public
* @return {Object} Object with newEntries and removedEntries
*/
ReferenceCounter.prototype.getSession = function() {
	var newEntries = [];
	var removedEntries = [];
	for(var key in this._session) {
		var val = this._session[key];
		if(val &gt; 0) {
			newEntries.push(key);
		} else if(val &lt; 0) {
			removedEntries.push(key);
		}
		// else {} // when val 0 do nothing, doesn't change anything
	}
	return {
		newEntries: newEntries.filter(Boolean),
		removedEntries: removedEntries.filter(Boolean)
	};
};

/** @public
* @param {string} key
* @param {string=} referer Referer can only add specific key only once
* @return {boolean} True if new reference is added
*/
ReferenceCounter.prototype.addReference = function(key, referer) {
	if(key) {
		if(referer) {
			var counter = this._referers[referer];
			if(counter) {
				if(counter[key]) { // Single Referer can only add specific key only once
					return false;
				}
			} else {
				counter = this._referers[referer] = {};
			}
			counter[key] = 1;
		}

		if(this._counter[key]) {
			++this._counter[key];
			// The session will not change when a field already exists and a counter is attempted to be added
		} else {
			this._counter[key] = 1;
			if(this._session[key] === -1) {
				this._session[key] = 0;
			} else {
				this._session[key] = 1;
			}

			return true;
		}
	}
	return false;
};
/** @public
* @function
* @param {string} key
* @return {boolean} True if new reference is added
*/
ReferenceCounter.prototype.addRef = ReferenceCounter.prototype.addReference;

/** @public
* @param {string} key
* @param {string=} referer Referer can only add specific key only once
* @param {number=} count Use negative value to remove all counter from the given reference
* @return {boolean} True if existing reference is removed
*/
ReferenceCounter.prototype.removeReference = function(key, referer, count) {
	if(!key) {
		return false;
	}
	var val = this._counter[key];
	if(!val) {
		return false;
	}
	if(count == null) {
		count = 1;
	} else if(count &lt; 0) {
		count = val;
	} else if(!count) {
		return false;
	}

	if(referer) {
		var counter = this._referers[referer];
		if(!counter) {
			return false;
		}
		if(!counter[key]) {
			return false;
		}

		delete counter[key];
	}

	val -= count;
	if(!val || val &lt; 0) {
		delete this._counter[key];
		if(this._session[key] === 1) {
			this._session[key] = 0;
		} else {
			this._session[key] = -1;
		}
		return true;
	}

	this._counter[key] = val;
	return false;
};
/** @public
* @function
* @param {string} key
*/
ReferenceCounter.prototype.release = ReferenceCounter.prototype.removeReference;

/** @public
* @param {(string|Array.&lt;string&gt;|Object)} keys
* @param {string=} referer
* @return {number} Number of newly added entries
*/
ReferenceCounter.prototype.addReferences = function(keys, referer) {
	if(!keys) {
		return 0;
	}
	var count = 0;
	if(Array.isArray(keys)) {
		var len = keys.length;
		for(var i = 0; i &lt; len; ++i) {
			if(this.addReference(keys[i], referer)) {
				++count;
			}
		}
	} else if (typeof keys == "string") {
		if(this.addReference(keys, referer)) {
			++count;
		}
	} else {
		for(var key in keys) {
			if(this.addReference(key, referer)) {
				++count;
			}
		}
	}
	return count;
};

/** Remove all references from specific referer
* @public
* @param {string=} referer
* @return {number} Number of removed entries
*/
ReferenceCounter.prototype.removeReferer = function(referer) {
	var count = 0;
	if(referer) {
		var counter = this._referers[referer];
		if(counter) {
			for(var key in counter) {
				if(this.removeReference(key, referer)) {
					++count;
				}
			}
			delete this._referers[referer];
		}
	}
	return count;
};
/** Alias to ReferenceCounter.removeReferer
* @public
* @function
* @param {string=} referer
* @return {number} Number of removed entries
*/
ReferenceCounter.prototype.removeReferrer = ReferenceCounter.prototype.removeReferer;

/** Log current reference count to dev console
* @public
*/
ReferenceCounter.prototype.log = function() {
	console.log(this._counter);
};


export {ReferenceCounter};
export default ReferenceCounter;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ColumnDefinition.html">ColumnDefinition</a></li><li><a href="DataConnector.html">DataConnector</a></li><li><a href="Grid.html">Grid</a></li><li><a href="ReferenceCounter.html">ReferenceCounter</a></li><li><a href="RowDefinition.html">RowDefinition</a></li><li><a href="RowDefSorter.html">RowDefSorter</a></li><li><a href="SnapshotFiller.html">SnapshotFiller</a></li><li><a href="StyleLoader.html">StyleLoader</a></li></ul><h3>Events</h3><ul><li><a href="Grid.html#event:adcDataReceived">adcDataReceived</a></li><li><a href="Grid.html#event:afterContentBinding">afterContentBinding</a></li><li><a href="Grid.html#event:beforeContentBinding">beforeContentBinding</a></li><li><a href="Grid.html#event:beforeRowRemoved">beforeRowRemoved</a></li><li><a href="Grid.html#event:dataComposed">dataComposed</a></li><li><a href="Grid.html#event:fieldAdded">fieldAdded</a></li><li><a href="Grid.html#event:fieldRemoved">fieldRemoved</a></li><li><a href="Grid.html#event:firstRendered">firstRendered</a></li><li><a href="Grid.html#event:pageCountChanged">pageCountChanged</a></li><li><a href="Grid.html#event:pageIndexChanged">pageIndexChanged</a></li><li><a href="Grid.html#event:ricAdded">ricAdded</a></li><li><a href="Grid.html#event:ricRemoved">ricRemoved</a></li></ul><h3>Global</h3><ul><li><a href="global.html#COL_DEF">COL_DEF</a></li><li><a href="global.html#ROW_DEF">ROW_DEF</a></li><li><a href="global.html#ROW_TYPES">ROW_TYPES</a></li></ul>
</nav>


<script src="scripts/linenumber.js"> </script>
<script src="scripts/prettify.js"> </script>
<script> prettyPrint(); </script>
</body>
</html>
