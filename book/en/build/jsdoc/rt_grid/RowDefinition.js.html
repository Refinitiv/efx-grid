<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: RowDefinition.js</title>

    <script src="scripts/prettify.js"> </script>
    <script src="scripts/lang-css.js"> </script>
    <!--[if lt IE 9]&gt;
      &lt;script src="//html5shiv.googlecode.com/svn/trunk/html5.js"&gt;&lt;/script&gt;
    &lt;![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/default.css">
    <link type="text/css" rel="stylesheet" href="styles/elf-template.css">
</head>

<body>

<div id="main-template" class="elf-template">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { arrayToObject, cloneObject } from "../../node_modules/tr-grid-util/es6/Util.js";
/* eslint-disable */
import { DataCache } from "../../node_modules/@grid/core/es6/data/DataCache.js";
import { DataTable } from "../../node_modules/@grid/core/es6/data/DataTable.js";
/* eslint-enable */

/** @typedef {Object} RowDefinition~Options
* @description RowDefinition options
* @property {string=} ric="" RIC for real-time fields. Prefixing 0# to the ric is equivalent to specifying asChain property.
* @property {string=} permId="" Organization PermId to be used instead of ric for private company.
* @property {(Array|Object)=} values=null Values for static data
* @property {Array.&lt;string&gt;=} fields=null Field that corresponds to the given static values
* @property {boolean=} asChain=false The given ric will be treated as a chain
* @property {string=} chainRic="" RIC to be used for chain request (overiding ric property)
* @property {boolean=} collapsed=true Chain is collapsed by default
* @property {(string|null)=} label=null
* @property {boolean=} hidden=true When this row is hidden
* @pro // realTime
*/

/** @typedef {Object} RowDefinition~RowTypes
* @property {string} CONTENT="CONTENT" Regular row
* @property {string} CHAIN="CHAIN" Chain RIC row
* @property {string} CONSTITUENT="CONSTITUENT" Constituent row
* @property {string} GROUP_HEADER="GROUP_HEADER" Row of segment separator at the very top
* @property {string} SUBGROUP_HEADER="SUBGROUP_HEADER" Row of nested segment separator
* @property {string} GROUP_MEMBER="GROUP_MEMBER" Child row displayed under segment separator
*/

/** @type {string}
* @public
* @const
*/
var ROW_DEF = "ROW_DEF";

/** @type {!RowDefinition~RowTypes}
* @public
* @const
*/
var ROW_TYPES = {
	CONTENT: "CONTENT",
	CHAIN: "CHAIN",
	CONSTITUENT: "CONSTITUENT",
	GROUP_HEADER: "GROUP_HEADER",
	SUBGROUP_HEADER: "SUBGROUP_HEADER",
	GROUP_MEMBER: "GROUP_MEMBER"
};

/** @constructor
* @param {RowDefinition~Options=} rowOptions
*/
var RowDefinition = function(rowOptions) {
	this._changes = {};
	if(rowOptions &amp;&amp; rowOptions["segmentId"]) { // This row will be classification header row
		this._dataId = this._rowId = rowOptions["segmentId"];
		this._autoGenerated = true;
		this._subSegment = true;
		return;
	}

	this._rowId = "_" + RowDefinition._runningId++ + "_";
	this._dataId = this._rowId;

	if(rowOptions) {
		if(rowOptions["asConstituent"]) { // Create row definition as a constituent of a chain
			this._initializeAsConstituent(rowOptions); // WARNING: This does not follow normal initialization process
		} else {
			this.initialize(rowOptions);
		}
	}
};

/** @type {number}
* @private
*/
RowDefinition._runningId = 0;
/** @type {string}
* @private
*/
RowDefinition._childDataField = "CHILD_VALUES";
//#region Private Members
/** @type {string}
* @private
*/
RowDefinition.prototype._userInput = "";
/** @type {string}
* @private
*/
RowDefinition.prototype._ric = ""; // Contains no 0#
/** @type {string}
* @private
*/
RowDefinition.prototype._permId = "";
/** @type {string|null}
* @private
*/
RowDefinition.prototype._label = null; // Label overrides _ric and _permId
/** @type {boolean|null}
* @private
*/
RowDefinition.prototype._isChain = null;
/** @type {boolean}
* @private
*/
RowDefinition.prototype._realTime = true;

/** @type {string}
* @private
*/
RowDefinition.prototype._rowId = ""; // Row Id must be unique
/** @type {string}
* @private
*/
RowDefinition.prototype._dataId = ""; // Data id can be different from rowId for constituents of a chain
/** @type {DataCache}
* @private
*/
RowDefinition.prototype._dc = null;
/** @type {DataTable}
* @private
*/
RowDefinition.prototype._view = null;

/** @type {string}
* @private
*/
RowDefinition.prototype._subId = "";

/** @type {boolean|null}
* @private
*/
RowDefinition.prototype._expanded = null;
/** @type {boolean}
* @private
*/
RowDefinition.prototype._autoGenerated = false;
/** @type {boolean}
* @private
*/
RowDefinition.prototype._subSegment = false;
/** @type {Object.&lt;string, *&gt;}
* @private
*/
RowDefinition.prototype._staticValues = null;
/** @type {!Object.&lt;string, number&gt;}
* @private
*/
RowDefinition.prototype._changes;
/** @type {number}
* @private
*/
RowDefinition.prototype._updateCount = 0;

/** @type {Array.&lt;RowDefinition&gt;}
* @private
*/
RowDefinition.prototype._children = null;
/** @type {RowDefinition}
* @private
*/
RowDefinition.prototype._parent = null;
/** @type {number}
* @private
*/
RowDefinition.prototype._groupOrder = 0; // For group sorting
/** @type {number}
* @private
*/
RowDefinition.prototype._depthLevel = 0;

/** @type {Object}
* @private
*/
RowDefinition.prototype._userModel = null;
//#endregion Private Members

/** @public
*/
RowDefinition.prototype.dispose = function() {
	if(this.isDisposed()) {
		return;
	}

	if(this._children) {
		this._children.forEach(RowDefinition.dispose);
		this._children = null;
	}

	this._staticValues = null; // Static values contain user data
	this._parent = null; // WARNING: This does not impact children count of the parent. A child must be destroyed by its parent only
	this._depthLevel = 0;
	this.unsubscribeForUpdates();
	if(this._dc) {
		var rowData = this.getRowData();
		if(rowData) {
			rowData[ROW_DEF] = null;
		}
		this._dc = null;
	}
	if(this._view) {
		this._view = null;
	}
	this._rowId = this._dataId = "";
	this._userModel = null;
};
/** @public
* @return {boolean}
*/
RowDefinition.prototype.isDisposed = function() {
	return !this._rowId;
};
/** @public
* @param {RowDefinition~Options=} rowOptions
*/
RowDefinition.prototype.initialize = function(rowOptions) {
	if(!rowOptions) {
		return;
	}

	var val = rowOptions["permId"];
	if(val != null) {
		this._permId = val;
	}
	val = rowOptions["ric"];
	if(val != null) {
		this._ric = val;
	}
	val = rowOptions["label"];
	// eslint-disable-next-line no-undefined
	if(val !== undefined) { // Empty string and null are allowed
		this._label = val;
	}
	val = rowOptions["chainRic"];
	if(val != null) {
		this._chainRic = val;
	}
	val = rowOptions["values"];
	// eslint-disable-next-line no-undefined
	if(val !== undefined) {
		this.setStaticRowData(val, rowOptions["fields"]);
	}

	val = rowOptions["asChain"];
	if(val !== null) {
		this._isChain = val;
	}

	val = rowOptions["realTime"];
	if(val != null) {
		this._realTime = val;
	}

	val = rowOptions["collapsed"];
	if(val != null){
		this._expanded = !val;
	}
	val = rowOptions["keepModel"];
	if(val) {
		this._userModel = rowOptions;
	}

	var expanded = this._expanded;
	var symbol = this._ric || this._chainRic;
	var asChain = this._isChain || !!this._chainRic;
	if(this._ric &amp;&amp; this._ric.indexOf("0#") &gt;= 0){
		asChain = true;
		expanded = true;
	}
	if(this._isChain === false){
		asChain = false;
	}
	if(this._expanded === false){
		expanded = false;
	}
	if(symbol || this._permId){
		this.setContent(symbol, this._permId, asChain, expanded); // this._dataId is modified
	}
};
/** @private
* @param {!Object} rowOptions
*/
RowDefinition.prototype._initializeAsConstituent = function(rowOptions) {
	this._autoGenerated = true;
	var parentDef = /** @type{RowDefinition} */(rowOptions["parent"]);
	if(this.setParent(parentDef)) {
		this._dataId = /** @type{string} */(rowOptions["dataId"]); // Constituent will have the same subId as its parent but with different ric
		this._ric = /** @type{string} */(rowOptions["ric"]);
		this._dc = parentDef._dc; // Parent chain must have data cache
		if(this._dc) {
			var rowData = this.getRowData(); // Do not trigger any data update
			if(rowData) { // Row data from data cache must exist beforehand
				rowData[ROW_DEF] = this;  // This is for easy referencing from data streaming, also for preventing duplication
			}
		}
	}
	var val = rowOptions["values"];
	// eslint-disable-next-line no-undefined
	if(val !== undefined) {
		this.setStaticRowData(val, rowOptions["fields"]);
	}
};
/** @public
* @param {string} userInput RIC
* @param {string=} permId=null Organization PermId, which use for getting ADC data for private  company
* @param {boolean=} asChain
* @param {boolean=} expanded
* @param {boolean=} realTime
* @return {boolean} True if there is any change otherwise false
*/
RowDefinition.prototype.setContent = function(userInput, permId, asChain, expanded) {
	if(this._autoGenerated) { // AutoGenerated RowDefinition cannot be changed by user input
		return false;
	}

	if(!userInput) { // 0 is not a valid input
		userInput = "";
	} else if(typeof userInput !== "string") {
		userInput += "";
	}

	var dirty = (this._userInput !== userInput);
	if(this._permId !== permId){
		this._permId = permId || "";
		dirty = true;
	}
	if(!dirty) {
		return false;
	}

	this.unsubscribeForUpdates();
	this.resetUpdates(); // Remove all previous data updates because a new content is just entered

	// TODO: handle changing between chain and ric row
	this._userInput = userInput;
	if(this._userInput.charAt(0) === "'") { // This is a row header
		this._ric = this._chainRic = ""; // No ric for realtime request
	} else {
		if(this._userInput.indexOf("0#") &gt;= 0) {
			if(asChain === false){
				this._ric = this._userInput;
			} else {
				this._ric = expanded === false ? this._userInput : this._userInput.replace("0#", "");
				this._expanded = expanded;
				this._isChain = true; // Only chain can be expanded by 0#
				this._chainRic = this._userInput;
				if(this._view) {
					this._view.setSegmentSeparator(this._rowId);
					this.expandChain();
				}
			}
		} else {
			this._ric = this._userInput;
			if(asChain){
				this._isChain = true;
			}
		}
	}

	this._dataId = this._rowId + this.getSymbol(); // JET/RTK will generate data id to be rowId (given from this rowDef) + ric;


	if(!this.subscribeForUpdates()) {
		if(this._dc) {
			// This will work for runtime ric modification, but not for first initilization.
			// Avoid losing the ROW_DEF pointer.
			var rowData = {};
			rowData[ROW_DEF] = this; // Enable tracking back and updating data
			rowData["X_RIC_NAME"] = this.getDisplayText();
			this.setRowData(rowData);
		}
	}
	return true;
};
/** @public
* @return {string} Row Id will never be empty string unless the row has been removed
*/
RowDefinition.prototype.getRowId = function() {
	return this._rowId;
};
/** @public
* @param {RowDefinition~Options=} rowOptions
* @return {RowDefinition~Options}
*/
RowDefinition.prototype.getConfigObject = function(rowOptions) {
	var obj = rowOptions || {};
	var val = this._ric;
	if(val) {
		obj["ric"] = val;
	}

	// The user passed a single quote (') case
	if(!this._ric &amp;&amp; this._userInput.charAt(0) === "'") {
		obj["ric"] = this._userInput;
	}

	val = this._realTime;
	if(val !== true) {
		obj["realTime"] = val;
	}

	val = this._permId;
	if(val) {
		obj["permId"] = val;
	}

	val = this._chainRic;
	if(val) {
		obj["chainRic"] = val;
	}

	val = this._label;
	if(val) {
		obj["label"] = val;
	}

	val = this._userModel;
	if(val) {
		obj["keepModel"] = obj;
	}

	val = this._isChain;
	if(val != null) {
		obj["asChain"] = val;
	}

	val = this._expanded;
	if(val != null) {
		obj["collapsed"] = !val;
	}

	// check row hidden
	val = this._view.isHiddenRow(this._rowId);
	if(val) {
		obj["hidden"] = val;
	}

	val = this._getStaticRowData();
	if(val) {
		obj["values"] = val;
	}

	// obtain the static values of constituent rows
	if(this.isChain()) {
		var children = this.getChildren();
		if(children) {
			var childValues = val ? val[RowDefinition._childDataField] : {};
			if(!childValues) {
				childValues = {};
			}
			var dirty = false;
			var len = children.length;
			var i, rowDef, staticValues;
			for(i = 0; i &lt; len; i++) {
				rowDef = children[i];
				staticValues = rowDef._getStaticRowData();
				if(staticValues) {
					dirty = true;
					childValues[rowDef.getRic()] = staticValues;
				}
			}

			if(dirty) {
				if(!obj["values"]) {
					obj["values"] = {};
				}
				obj["values"][RowDefinition._childDataField] = childValues;
			}
		}
	}

	return obj;
};
/** Since an index chain (e.g. .FTSE) can automatically produce rows for its constituent, we need to separate rowId and dataId, so that the constituents still use the same data Id as that of its parent.
* @public
* @return {string} Data Id will never be empty string unless the row has been removed
*/
RowDefinition.prototype.getDataId = function() {
	return this._dataId;
};
/** @public
* @return {string}
*/
RowDefinition.prototype.getType = function() {
	if(this._isChain) {
		return ROW_TYPES.CHAIN;
	} else if(this._parent) {
		return ROW_TYPES.CONSTITUENT;
	} else {
		var dv = this._view;
		if(dv) {
			var rid = this.getRowId();
			var separator = dv.isSegmentSeparator(rid);
			var level = dv.getSegmentLevel(rid);
			if(separator) {
				if(level === 1) {
					return ROW_TYPES.GROUP_HEADER;
				} else {
					return ROW_TYPES.SUBGROUP_HEADER;
				}
			} else {
				if(dv.getSegmentParentRowId(rid)) {
					return ROW_TYPES.GROUP_MEMBER;
				}
			}
		} else {
			return "";
		}
	}
	return ROW_TYPES.CONTENT;
};
/** This method should always be called right after the initialization
* @public
* @param {DataCache} dataSource
*/
RowDefinition.prototype.setDataSource = function(dataSource) {
	this._dc = dataSource || null;
	if(!this._dc) {
		return;
	}

	var rowData = this.getRowData();
	if(!rowData) {
		rowData = {};
		rowData[ROW_DEF] = this; // Enable tracking back and updating data
		rowData["X_RIC_NAME"] = this.getDisplayText();
		this.setRowData(rowData); // TODO: This will dispatch dataChanged event and caused update to be added, which should not happen
	}

	// Add static value to the new source
	if(this._staticValues) {
		this.setRowData(this._staticValues);
	}

	// This will work for runtime row insertion, but not for first initilization.
	this.subscribeForUpdates();
};
/** @public
* @return {DataCache} dataSource
*/
RowDefinition.prototype.getDataSource = function() {
	return this._dc;
};

/** @public
* @return {Object} rowData
*/
RowDefinition.prototype.getRowData = function() {
	return this._dc ? this._dc.getRowData(this._dataId) : {};
};
/** @public
* @param {string} field
* @return {*} data
*/
RowDefinition.prototype.getData = function(field) {
	return this._dc ? this._dc.getData(this._dataId, field) : null;
};

/** @public
* @param {Object.&lt;string, *&gt;|Array} data
* @param {Array.&lt;string&gt;=} opt_fields In case of the given data is an array, this param will be used for mapping index to field
*/
RowDefinition.prototype.setStaticRowData = function(data, opt_fields) {
	this._clearStaticData();

	if(Array.isArray(data)) { // Convert array to object
		data = arrayToObject(data, opt_fields);
	}

	this._staticValues = (typeof data === "object") ? data : null;

	if(this._staticValues) {
		this.setRowData(data);
	}
};
/** @public
* @return {Object.&lt;string, *&gt;}
*/
RowDefinition.prototype._getStaticRowData = function() {
	return this._staticValues ? cloneObject(this._staticValues) : null;
};
/** @public
* @param {Object.&lt;string, *&gt;|Array} data
* @param {Array.&lt;string&gt;=} opt_fields In case of the given data is an array, this param will be used for mapping index to field
*/
RowDefinition.prototype.updateRowData = function(data, opt_fields) {
	if(Array.isArray(data)) { // Convert array to object
		data = arrayToObject(data, opt_fields);
	}

	if(data) {
		this.setRowData(data);
	}
};
/** @public
* @param {string} field
* @param {*} value
*/
RowDefinition.prototype.setStaticData = function(field, value) {
	if(!this._staticValues) {
		this._staticValues = {};
	}
	this._staticValues[field] = value;

	this.setData(field, value);
};
/** @public
* @param {Object.&lt;string, *&gt;} data
*/
RowDefinition.prototype.setRowData = function(data) {
	if(this._dc) {
		this._dc.setRowData(this._dataId, data);
	}
};
/** @public
* @param {string} field
* @param {*} value
*/
RowDefinition.prototype.setData = function(field, value) {
	if(this._dc) {
		this._dc.setData(this._dataId, field, value);
	}
};
/** @private
*/
RowDefinition.prototype._clearStaticData = function() {
	if(this._staticValues) {
		for(var key in this._staticValues) {
			this._staticValues[key] = null;
		}
		if(this._dc) {
			this._dc.setRowData(this._dataId, this._staticValues);
		}
		this._staticValues = null;
	}
};

/** @public
* @return {string}
*/
RowDefinition.prototype.getUserInput = function() {
	return this._userInput;
};
/** @public
* @return {string}
*/
RowDefinition.prototype.getRic = function() {
	return this._ric;
};
/** @public
* @return {string}
*/
RowDefinition.prototype.getPermId = function() {
	return this._permId;
};
/** @public
* @return {string}
*/
RowDefinition.prototype.getSymbol = function() {
	return this._ric || this._permId;
};
/** @public
* @return {string}
*/
RowDefinition.prototype.getDisplayText = function() {
	if(this._label != null) { // Empty string is allowed
		return this._label;
	}

	if(this._ric) {
		return this._ric;
	}

	if(this._permId) {
		return this._permId;
	}

	return this._userInput;
};
/** @public
* @return {string|null}
*/
RowDefinition.prototype.getLabel = function() {
	return this._label;
};

/** @public
* @return {boolean}
*/
RowDefinition.prototype.isRowHeader = function() {
	return (this._userInput.charAt(0) === "'");
};
/** @public
* @return {boolean}
*/
RowDefinition.prototype.isChain = function() {
	return this._isChain;
};
/** @public
* @function
* @param {RowDefinition} rowDef
* @return {boolean}
*/
RowDefinition.hasChain = function(rowDef) {
	return rowDef.isChain();
};
/** @public
* @return {boolean}
*/
RowDefinition.prototype.isChainCollapsed = function() {
	if(this._view) {
		return this._view.isSegmentCollapsed(this._rowId);
	}
	return false;
};
/** @public
* @return {boolean}
*/
RowDefinition.prototype.isChainExpanded = function() {
	return !this.isChainCollapsed();
};
/** @public
* @ignore
* @return {boolean}
*/
RowDefinition.prototype.isFixedPosition = function() {
	return this._isChain &amp;&amp; this.isChainExpanded();
};
/** @public
* @return {boolean}
*/
RowDefinition.prototype.isAutoGenerated = function() {
	return this._autoGenerated;
};
/** @public
* @return {boolean}
*/
RowDefinition.prototype.isRealTimeRow = function() {
	if(!this.getRic()) { // Empty row
		return false;
	}
	if(!this._realTime) {
		return false;
	}

	if(this._autoGenerated) { // Constituents in chain are not real-time row
		return false;
	}

	if(this.isRowHeader()) {
		return false;
	}

	return true;
};

/** @public
* @return {boolean} If a subscription is made, return true.
*/
RowDefinition.prototype.subscribeForUpdates = function() {
	if(!this.isRealTimeRow() &amp;&amp; !this.getPermId()) {
		return false;
	}

	var subs = this._dc ? this._dc.getSubscriptions() : null;
	if(!subs) {
		return false;
	}
	// TODO: Check if the same subscription is being made.
	var prevRowData = this.unsubscribeForUpdates();

	if(this.isChain()) {
		this._subId = subs["addChain"](this._chainRic || this._ric, this._rowId); // Some chain require 0# symbol to populate its constituents
		// TODO: Handle Dynamic chain such as .PG.PA
	} else if(this._ric) {
		this._subId = subs["addRic"](this._ric, this._rowId);
	}

	if(prevRowData) {
		this._dc.setRowData(this._dataId, prevRowData); // TODO: We may need to create a new object instead of prevRowData for data correctness
	} else {
		this._dc.setRowData(this._dataId, {"X_RIC_NAME": this.getDisplayText(), "ROW_DEF": this}); // Trigger data update immediately
	}
	return true;
};
/** @public
 * @returns {*}
*/
RowDefinition.prototype.unsubscribeForUpdates = function() {
	if(!this._subId) {
		return;
	}

	var subs = this._dc.getSubscriptions();
	var prevRowData = this.getRowData();

	subs["removeSubscription"](this._subId);
	this._subId = "";
	this.resetUpdates();
	// TODO: Reset only if this is the last ric
	this._dc.setRowData(this._dataId, null); // Trigger data update immediately
	// TODO: Handle static values
	// eslint-disable-next-line consistent-return
	return prevRowData;
};
/** @public
* @return {boolean}
*/
RowDefinition.prototype.isSubscribing = function() {
	return this._subId ? true : false;
};

/** Take event argument from streaming update with "changes" array property
* @public
* @param {Object} e Object with changes property
* @return {boolean} Returns true if there is any change
*/
RowDefinition.prototype.addUpdate = function(e) {
	if(e) {
		var changes = e["changes"];
		if(changes) {
			var dirty = 0;
			for(var field in changes) {
				this._changes[field] = dirty = 1;
			}
			if(dirty) {
				++this._updateCount;
				return true;
			}
		}
	}
	return false;
};
/** If there is no update, this method returns null
* @public
* @return {Object.&lt;string, number&gt;}
*/
RowDefinition.prototype.getUpdates = function() {
	return this._updateCount ? this._changes : null;
};
/** @public
*/
RowDefinition.prototype.resetUpdates = function() {
	if(this._updateCount) {
		this._changes = {};
		this._updateCount = 0;
	}
};

/** @public
* @param {DataTable} view
* @param {string=} rowId
*/
RowDefinition.prototype.registerToView = function(view, rowId) {
	if(!view || this._view === view) {
		return; // Already in the view
	}
	this._view = view;

	var rowData = null;
	if(this._subSegment) {
		rowData = this._view.getRowData(this.getRowId());
		if(rowData) {
			rowData[ROW_DEF] = this; // no event trigger
		}
		return;
	}

	rowData = {};
	rowData[ROW_DEF] = this;

	var newRowId = this._view.insertRow(rowId, rowData, this.getRowId());
	this._rowId = newRowId; // In case there is some duplicate row id.

	if(this._isChain) {
		view.setSegmentSeparator(this._rowId);
		if(!this._expanded) {
			this.collapseChain();
		}
	}
};
/** @private
* @param {Array.&lt;string&gt;=} rowIds
* @return {string}
*/
RowDefinition.prototype._deregisterFromView = function(rowIds) {
	if(this._view) {
		if(rowIds) {
			rowIds.push(this._rowId);
		}

		this._view = null;
		return this._rowId;
	}
	return "";
};
/** @public
* @function
* @param {Array.&lt;string&gt;} rowIds
* @param {RowDefinition} rowDef
* @return {Array.&lt;string&gt;}
* @example
* var rowIds = descendants.reduce(RowDefinition.deregisterFromView, []);
*/
RowDefinition.deregisterFromView = function(rowIds, rowDef) {
	rowDef._deregisterFromView(rowIds);
	return rowIds;
};
/** @private
* @param {string} ric
* @return {Object}
*/
RowDefinition.prototype._getChildStaticRowData = function(ric) {
	if(!this._staticValues) {
		return null;
	}

	var childValues = this._staticValues[RowDefinition._childDataField];
	if(!childValues) {
		return null;
	}

	return childValues[ric] || null;
};
/** @public
* @ignore
* @param {string} ric
* @return {RowDefinition} Return newly created child definition, if success
*/
RowDefinition.prototype.addConstituent = function(ric) {
	if(!ric || this._ric === ric) { // Parent cannot have a child with no name or the same name as itself
		return null;
	}
	if(!(this._rowId &amp;&amp; this._subId &amp;&amp; this._isChain)) { // Chain must be alive (has not been disposed). Chain must be subscribed as chain
		return null;
	}

	var childDef = null;
	if(this._children) {
		for(var i = this._children.length; --i &gt;= 0;) {
			if(this._children[i]._ric === ric) {
				childDef = this._children[i]; // Constituent has already been added
				break;
			}
		}
	} else {
		this._children = [];
	}

	var newChild = !childDef;
	if(newChild) {
		var rowOptions = {
			"asConstituent": true,
			"dataId": this._subId + ric,
			"ric": ric,
			"parent": this
		};

		var staticData = this._getChildStaticRowData(ric);
		if(staticData) {
			rowOptions["values"] = staticData;
		}

		childDef = new RowDefinition(rowOptions);
	}

	if(this._view) {
		// WARNING: ChildCount may not be enough to determine proper inserting position
		// TODO: Handle nested children
		var rowId = this.getRowId();
		var rowIndex = this._view.getRowIndex(rowId) + this.getChildCount(); // Children must be directly under its parent
		childDef.registerToView(this._view, this._view.getRowId(rowIndex));
		this._view.addSegmentChild(rowId, childDef.getRowId(), childDef.getDataId());
	}

	return newChild ? childDef : null;
};

/** Used to convert autogenerated row to regular real-time row
* @public
*/
RowDefinition.prototype._toRealTimeRow = function() {
	if(!this._ric) { // Empty row
		return;
	}
	if(this.isRowHeader()) {
		return;
	}

	this._realTimeField = true;
	this._dataId = this._rowId + this._ric; // JET/RTK will generate data id to be rowId (given from this rowDef) + ric;

	this._autoGenerated = false;
	this._parent = null;
	this._depthLevel = 0;

	this.subscribeForUpdates();
};

/** @public
*/
RowDefinition.prototype.unlinkChain = function() {
	if(!this._isChain) {
		return;
	}

	if(this.isChainExpanded()) {
		var rowDefs = this.getDescendants();
		var len = rowDefs.length;
		for(var i = 0; i &lt; len; i++) {
			rowDefs[i]._toRealTimeRow();
		}
	}

	this.unsubscribeForUpdates();

	var view = this._view;
	if(view) {
		var rid = this.getRowId();
		var segment = view.getSegment(rid);
		if(segment) {
			segment.setClassification(null);
		}
		view.setSegmentSeparator(rid, false);
	}

	this._isChain = this._expanded = false;
	this._chainRic = "";
	this._userInput = this._ric;
	this._children = null;

	this.subscribeForUpdates();
};

/** @public
* @return {boolean} Returns true if there is a change in view
*/
RowDefinition.prototype.collapseChain = function() {
	if(this._isChain &amp;&amp; this._view) {
		this._expanded = false;
		return this._view.collapseSegment(this._rowId, true);
	}
	return false;
	// if(this._children) {
	// this._children.forEach(RowDefinition.dispose); // All descendants will be removed too
	// this._children = null;
	// }
	// unsub chain
	// resub index
};
/** @public
* @return {boolean} Returns true if there is a change in view
*/
RowDefinition.prototype.expandChain = function() {
	if(this._isChain &amp;&amp; this._view) {
		this._expanded = true;
		return this._view.collapseSegment(this._rowId, false);
	}
	return false;
	// unsub index
	// resub chain
};

/** Toggle between chain expanding and collapsing
* @public
* @return {boolean} Returns true if there is a change in view
*/
RowDefinition.prototype.toggleChain = function() {
	if(this._expanded) {
		return this.collapseChain();
	} else {
		return this.expandChain();
	}
};

/** @public
* @ignore
* @param {RowDefinition} childDef
* @return {boolean} Returns true if success
*/
RowDefinition.prototype.addChild = function(childDef) {
	if(!childDef) {
		return false;
	}
	return childDef.setParent(this);
};
/** @public
* @return {Array.&lt;RowDefinition&gt;}
*/
RowDefinition.prototype.getChildren = function() {
	return this._children;
};
/** Get all descendants (i.e. children and nested children).
* @public
* @param {Array.&lt;RowDefinition&gt;=} ary
* @return {!Array.&lt;RowDefinition&gt;} Flat list of row definitions. The order is corresponded to the order of the rows in the view
*/
RowDefinition.prototype.getDescendants = function(ary) {
	if(!ary) {
		ary = [];
	}
	if(this._children) {
		var chdr = this._children;
		var len = chdr.length;
		for(var i = 0; i &lt; len; ++i) {
			var ch = chdr[i];
			ary.push(ch);
			ch.getDescendants(ary);
		}
	}
	return ary;
};
/** Get rowIds of all descendants (i.e. children and nested children).
* @public
* @return {Array.&lt;string&gt;} Null if there is no row Id
*/
RowDefinition.prototype.getAllDescendantIds = function() {
	var descendants = this.getDescendants();
	if(descendants.length) {
		return descendants.map(RowDefinition.toRowId);
	} else {
		return null;
	}
};
/** @public
* @return {number}
*/
RowDefinition.prototype.getChildCount = function() {
	return (this._children) ? this._children.length : 0;
};
/** @public
* @return {RowDefinition}
*/
RowDefinition.prototype.getParent = function() {
	return this._parent;
};
/** @public
* @ignore
* @param {RowDefinition} parentDef
* @return {boolean} Returns true if success
*/
RowDefinition.prototype.setParent = function(parentDef) {
	if(this._parent === parentDef || parentDef === this) { // The same parent is given
		return false;
	}
	if(this._parent) { // Release from previous parent
		var at = this._parent._children.lastIndexOf(this);
		if(at &gt;= 0) {
			this._parent._children.splice(at, 1);
		}
		this._parent = null;
		this._depthLevel = 0; // TODO: Update depth of children
	}

	if(parentDef) {
		if(!parentDef._children) {
			parentDef._children = [];
		}
		// WARNING: No duplication checking
		parentDef._children.push(this);
		this._parent = parentDef;
		this._depthLevel = parentDef._depthLevel + 1; // TODO: Update depth of children
		return true;
	}
	return false;
};
/** @public
* @return {number}
*/
RowDefinition.prototype.getDepthLevel = function() {
	return this._depthLevel;
};
/** @public
* @ignore
* @return {number}
*/
RowDefinition.prototype.getGroupOrder = function() {
	if(this._parent) {
		return this._parent.getGroupOrder() + 0.1; // Plus level. TODO: Support nested level
	}
	return this._groupOrder;
};
/** @public
* @ignore
* @param {number} num
* @return {boolean} Return true if there is any change
*/
RowDefinition.prototype.setGroupOrder = function(num) {
	if(!this._parent) { // Only root node can have group order
		if(this._groupOrder !== num) {
			this._groupOrder = num;
			return true;
		}
	}
	return false;
};

/** @public
* @return {Object}
*/
RowDefinition.prototype.getUserModel = function() {
	return this._userModel;
};

/** For mapping row Id by Array.map()
* @public
* @function
* @param {RowDefinition} rowDef
* @return {string} Row Id will never be empty string unless the row has been removed
*/
RowDefinition.toRowId = function(rowDef) {
	return rowDef.getRowId();
};
/** For mapping row Id by Array.map()
* @public
* @function
* @param {RowDefinition} rowDef
*/
RowDefinition.dispose = function(rowDef) {
	rowDef.dispose();
};

export {RowDefinition, ROW_DEF, ROW_TYPES};
export default RowDefinition;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ColumnDefinition.html">ColumnDefinition</a></li><li><a href="DataConnector.html">DataConnector</a></li><li><a href="Grid.html">Grid</a></li><li><a href="ReferenceCounter.html">ReferenceCounter</a></li><li><a href="RowDefinition.html">RowDefinition</a></li><li><a href="RowDefSorter.html">RowDefSorter</a></li><li><a href="SnapshotFiller.html">SnapshotFiller</a></li><li><a href="StyleLoader.html">StyleLoader</a></li></ul><h3>Events</h3><ul><li><a href="Grid.html#event:adcDataReceived">adcDataReceived</a></li><li><a href="Grid.html#event:beforeRowRemoved">beforeRowRemoved</a></li><li><a href="Grid.html#event:dataComposed">dataComposed</a></li><li><a href="Grid.html#event:fieldAdded">fieldAdded</a></li><li><a href="Grid.html#event:fieldRemoved">fieldRemoved</a></li><li><a href="Grid.html#event:pageCountChanged">pageCountChanged</a></li><li><a href="Grid.html#event:pageIndexChanged">pageIndexChanged</a></li><li><a href="Grid.html#event:ricAdded">ricAdded</a></li><li><a href="Grid.html#event:ricRemoved">ricRemoved</a></li></ul><h3>Global</h3><ul><li><a href="global.html#COL_DEF">COL_DEF</a></li><li><a href="global.html#ROW_DEF">ROW_DEF</a></li><li><a href="global.html#ROW_TYPES">ROW_TYPES</a></li></ul>
</nav>


<script src="scripts/linenumber.js"> </script>
<script src="scripts/prettify.js"> </script>
<script> prettyPrint(); </script>
</body>
</html>
